#!/bin/bash

delay=0.5s
printUsage()
{
    cat <<HELPTEXT
Print file contents on standard output line per line with delay.
Usage: "$(basename "$1")" [--delay NUMBER[SUFFIX]] FILE, ... [-?|-h|--help]
HELPTEXT
}
case "$1" in
    --help|-h|-\?)	shift; printUsage "$0"; exit 0;;
    --delay)		shift; delay=$1; shift;;
esac

cat "$@" | while IFS=$'\r' read -ra lines
do
    let cnt=0
    for line in "${lines[@]}"
    do
	let cnt+=1

	# Return to the first column before printing a subsequent internal line
	# fragment.
	[[ $cnt > 1 ]] && prefix='\r' || prefix=

	# Conclude the last line fragment with a newline.
	[[ $cnt = ${#lines[@]} ]] && suffix='\n' || suffix=

	printf "${prefix}%s${suffix}" "$line"

	sleep "$delay"
    done
done
