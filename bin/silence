#!/bin/bash

printShortUsage()
{
    cat <<SHORTHELPTEXT
Usage: "$(basename "")" program|pid [-?|-h|--help]
SHORTHELPTEXT
}

if [ $# -eq 0 ]; then
    echo >&2 'Pass either the process ID or the name of the program that you want to silence.'
    exit 2
fi
case "$1" in
    --help|-h|-\?)	shift; printShortUsage ""; exit 0;;
esac

if [[ "$1" =~ ^[0-9]*$ ]]; then
    pid=$1
else
    pid=$(pidof -- "$1") || { echo >&2 "No program found!"; exit 1; }
    if [[ "$pid" =~ [[:space:]] ]]; then
	echo >&2 "Multiple programs found!"
	exit 1
    fi
fi

echo "Silencing ${pid}: $(ps -p $pid -o args=)"

gdb \
    -ex 'p dup2(open("/dev/null",1),1)' \
    -ex 'p dup2(1,2)' \
    -ex 'detach' \
    --batch \
    -p $pid
