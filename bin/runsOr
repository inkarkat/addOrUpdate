#!/bin/bash

printUsage()
{
    cat <<HELPTEXT
Tests whether the passed pgrep [OPTIONS] PATTERN is running as (at least one)
process. If not, it asks the user whether to start it. If confirmed, this will
execute the shell COMMANDS read from stdin.
HELPTEXT
printf 'Usage: echo COMMANDS | %q %s\n' "$(basename "$1")" '[--bare] [OPTIONS] PATTERN [-?|-h|--help]'
printf 'Usage: %q %s <<EOF\n  COMMANDS\nEOF\n' "$(basename "$1")" '[...] PATTERN'
}
isBare=
case "$1" in
    --help|-h|-\?)	shift; printUsage "$0"; exit 0;;
    --bare)		shift; isBare=t;;
esac
if [ $# -eq 0 ]; then
    printUsage "$0" >&2
    exit 2
fi

pgrep --count "$@" >/dev/null && exit 0

memoizeDecision --memorize-group "$(basename -- "$0").$PPID" --subject "$EXECUTABLE" --state 'run' --action 'Start it' || exit 2

if [ "$isBare" ]; then
    bash -
else
    runWithPrompt --no-trailing-prompt
fi
