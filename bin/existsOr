#!/bin/bash

printUsage()
{
    cat <<HELPTEXT
Tests whether the passed EXECUTABLE exists in PATH. If not, it asks the user
whether to define it. If confirmed, this will execute the shell COMMANDS read
from stdin.
HELPTEXT
printf 'Usage: echo COMMANDS | %q %s\n' "$(basename "$1")" 'EXECUTABLE [-?|-h|--help]'
printf 'Usage: %q %s <<EOF\n  COMMANDS\nEOF\n' "$(basename "$1")" 'EXECUTABLE'
}
case "$1" in
    --help|-h|-\?)	shift; printUsage "$0"; exit 0;;
esac
if [ $# -ne 1 ]; then
    printUsage "$0" >&2
    exit 2
fi

'which' "${1:?}" >/dev/null 2>&1 && exit 0

MARKER_FILESPEC="$(echo "${TEMP:-/tmp}/$(basename -- "$0").$PPID")"

if [ -e "$MARKER_FILESPEC" ]; then
    printf '%s does not exist. Defining it now.\n' "$1"
    CHOICE=y
else
    < /dev/tty read -p "$1 does not exist. Define it? (y/n/a) " CHOICE
fi
if [ "$CHOICE" = 'a' ]; then
    touch "$MARKER_FILESPEC"
    CHOICE=y
fi

[ "$CHOICE" = 'y' ] || exit 2

cat | bash -
